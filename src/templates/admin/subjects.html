{% extends "admin/base_admin.html" %}
{% block admin_content %}

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

  <!-- Left: All Subjects -->
  <section class="bg-white border border-gray-200 rounded-xl shadow-sm p-4">
    <h2 class="text-lg font-semibold text-academic-navy border-b-4 border-academic-navy pb-1 mb-3">
      All Subjects
    </h2>

    {% if subjects %}
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left font-semibold text-gray-700">Name</th>
              <th class="px-4 py-2 text-right font-semibold text-gray-700 w-48">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
          {% for s in subjects %}
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-2">{{ s.name }}</td>
              <td class="px-4 py-2">
                <div class="flex gap-2 justify-end">
                  <a href="{{ url_for('admin.subjects_edit', subject_id=s.id) }}"
                     class="px-3 py-1.5 rounded-lg border border-academic-navy text-academic-navy text-sm hover:bg-academic-navy hover:text-white transition">
                    Edit
                  </a>
                  <button type="button"
                          class="px-3 py-1.5 rounded-lg bg-red-600 text-white text-sm hover:bg-red-700 transition"
                          onclick="confirmDelete({{ s.id }}, '{{ s.name }}')">
                    Delete
                  </button>
                </div>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-sm text-gray-500">No subjects yet.</p>
    {% endif %}
  </section>

  <!-- Right: Create / Edit -->
  <section class="bg-white border border-gray-200 rounded-xl shadow-sm p-4">
    {% if edit_mode %}
      <h2 class="text-lg font-semibold text-academic-navy border-b-4 border-academic-navy pb-1 mb-3">
        Edit Subject
      </h2>
      <form method="post" action="{{ url_for('admin.subjects_update', subject_id=editing.id) }}" class="space-y-4">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
          <div class="flex gap-2 mt-1">
            <input id="name" name="name" type="text" maxlength="100"
                   value="{{ form_data.name|default('', true) }}"
                   class="flex-1 rounded-lg border border-gray-300 px-3 py-2 focus:ring-academic-navy focus:border-academic-navy sm:text-sm" required>
            <button type="submit"
                    class="px-4 py-2 rounded-lg bg-academic-navy text-white hover:bg-academic-maroon transition">
              Save
            </button>
            <a href="{{ url_for('admin.subjects') }}"
               class="px-4 py-2 rounded-lg border border-academic-navy text-academic-navy hover:bg-academic-navy hover:text-white transition">
              Cancel
            </a>
          </div>
          {% if errors and errors.name %}
            <p class="text-red-600 text-sm mt-1">{{ errors.name }}</p>
          {% endif %}
        </div>
      </form>
    {% else %}
      <h2 class="text-lg font-semibold text-academic-navy border-b-4 border-academic-navy pb-1 mb-3">
        Create Subject
      </h2>
      <form method="post" action="{{ url_for('admin.subjects_create') }}" class="space-y-4">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
          <div class="flex gap-2 mt-1">
            <input id="name" name="name" type="text" maxlength="100"
                   value="{{ form_data.name|default('', true) }}"
                   class="flex-1 rounded-lg border border-gray-300 px-3 py-2 focus:ring-academic-navy focus:border-academic-navy sm:text-sm" required>
            <button type="submit"
                    class="px-4 py-2 rounded-lg bg-academic-navy text-white hover:bg-academic-maroon transition">
              Create
            </button>
          </div>
          {% if errors and errors.name %}
            <p class="text-red-600 text-sm mt-1">{{ errors.name }}</p>
          {% endif %}
        </div>
      </form>
    {% endif %}
  </section>

</div>

<!-- Modal for delete confirmation -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-lg shadow-lg p-6 max-w-sm w-full">
    <h3 class="text-lg font-semibold text-red-600 mb-2">Delete Subject</h3>
    <p id="deleteMessage" class="text-sm text-gray-700 mb-4"></p>
    <form id="deleteForm" method="post">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <div class="flex justify-end gap-2">
        <button type="button" onclick="closeModal()"
                class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition">
          Cancel
        </button>
        <button type="submit"
                class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition">
          Delete
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  function confirmDelete(subjectId, subjectName) {
    const modal = document.getElementById("deleteModal");
    const message = document.getElementById("deleteMessage");
    const form = document.getElementById("deleteForm");

    message.textContent = `Are you sure you want to delete the subject "${subjectName}"? This will delete all questions and related test records.`;
    form.action = `/admin/subjects/${subjectId}/delete`;

    modal.classList.remove("hidden");
  }

  function closeModal() {
    document.getElementById("deleteModal").classList.add("hidden");
  }
</script>

{% endblock %}
