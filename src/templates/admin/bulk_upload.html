{% extends "admin/base_admin.html" %}
{% block admin_content %}

<div class="toolbar">
  <h2 class="h-academic" style="margin:0;">Bulk Upload</h2>
  <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
    <a class="btn btn-outline" href="{{ url_for('admin.download_template') }}">CSV Template</a>
    <a class="btn btn-outline" href="{{ url_for('admin.download_template', sample=1) }}">CSV + Sample Row</a>
    <a class="btn btn-ghost" href="{{ url_for('admin.questions') }}">Back to Questions</a>
  </div>
</div>

<section class="card" style="display:grid; grid-template-columns:1fr; gap:.75rem;">
  <div class="qmeta">
    Upload a CSV and (optionally) an images ZIP. Filenames inside the ZIP must match CSV filenames (flat, no subfolders).
    Images are saved with unique names to avoid collisions.
  </div>

  <pre style="margin:0; background:#f9fafb; border:1px solid var(--line); border-radius:8px; padding:.6rem .8rem; overflow:auto;">
subject, question_text, question_image, option_a, option_a_image, option_b, option_b_image, option_c, option_c_image, option_d, option_d_image, correct_option
  </pre>

  <form method="post" enctype="multipart/form-data" style="margin-top:.25rem;">
    {{ form.csrf_token }}

    <div style="display:grid; grid-template-columns:1fr 1fr; gap:.75rem;">
      <div>
        <label><strong>{{ form.csv_file.label.text }}</strong></label><br>
        {{ form.csv_file(class_="btn btn-outline", style="margin-top:.25rem;") }}
        {% for e in form.csv_file.errors %}<div style="color:#b00; margin-top:.25rem;">{{ e }}</div>{% endfor %}
      </div>

      <div>
        <label><strong>{{ form.images_zip.label.text }}</strong></label><br>
        {{ form.images_zip(class_="btn btn-outline", style="margin-top:.25rem;") }}
        {% for e in form.images_zip.errors %}<div style="color:#b00; margin-top:.25rem;">{{ e }}</div>{% endfor %}
      </div>
    </div>

    <div class="sticky-nav" style="margin-top:.75rem;">
      <div class="qmeta">Subjects must already exist. Images are optional.</div>
      <div style="display:flex; gap:.5rem;">
        {{ form.submit(class_="btn btn-primary") }}
        <a class="btn btn-outline" href="{{ url_for('admin.questions') }}">Cancel</a>
      </div>
    </div>
  </form>
</section>

{% if summary %}
  <section class="card" style="margin-top:1rem;">
    <h3 class="h-academic">Summary</h3>
    <div style="display:flex; gap:1rem; flex-wrap:wrap; margin-top:.5rem;">
      <div><strong>Created:</strong> {{ summary.created }}</div>
      <div><strong>Failed:</strong> {{ summary.failed }}</div>
      {% if summary.skipped is defined %}<div><strong>Skipped:</strong> {{ summary.skipped }}</div>{% endif %}
    </div>
  </section>
{% endif %}

{% if errors and errors|length %}
  <section class="card" style="margin-top:1rem;">
    <h3 class="h-academic">Errors</h3>
    <ol style="margin-top:.5rem;">
      {% for e in errors %}
        <li class="qmeta">{{ e }}</li>
      {% endfor %}
    </ol>
  </section>
{% endif %}

{% endblock %}
