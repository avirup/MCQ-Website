{% extends "base.html" %}
{% block content %}
<div class="page">
  <header style="display:flex;justify-content:space-between;align-items:center;gap:.75rem;">
    <h1 class="h-academic">Test Summary</h1>
    <div class="qmeta">
      Mode: {{ test.mode.value|capitalize }}
      {% if test.mode.value == 'interactive' and test.test_uid %}
        • Share ID: <code>{{ test.test_uid }}</code>
      {% endif %}
    </div>
  </header>

  <section class="banner" style="margin-top:1rem;">
    <div><strong>Total:</strong> {{ totals.total }}</div>
    <div>Correct: <strong style="color:var(--ok);">{{ totals.correct }}</strong></div>
    <div>Incorrect: <strong style="color:var(--bad);">{{ totals.incorrect }}</strong></div>
    <div>Unanswered: <strong style="color:var(--warn);">{{ totals.unanswered }}</strong></div>
    <div style="margin-left:auto; display:flex; gap:.5rem;">
      <a class="btn btn-primary" href="{{ url_for('student.review', test_id=test.id, q=1) }}">Start Detailed Review &rarr;</a>
      <a class="btn btn-outline" href="{{ url_for('student.home') }}">Back to Start</a>
    </div>
  </section>

  {% if test.mode.value == 'interactive' and test.test_uid %}
    <section style="margin-top:.75rem;">
      <div class="banner" style="background:#fff;">
        <div>Public (read-only) links:</div>
        <a class="btn btn-outline" href="{{ url_for('student.summary_by_uid', test_uid=test.test_uid) }}">Public Summary</a>
        <a class="btn btn-outline" href="{{ url_for('student.review_by_uid', test_uid=test.test_uid, q=1) }}">Public Detailed Review</a>
      </div>
    </section>
  {% endif %}

  <section style="margin-top:1rem;">
    <h3 class="h-academic">Jump to a Question</h3>
    <div style="display:flex; flex-wrap:wrap; gap:.5rem; margin-top:.75rem;">
      {# Build quick buttons 1..N with coloring #}
      {% for i in range(1, test.total_questions + 1) %}
        {% set qid = test.questions[i-1].question_id %}
        {% set resp = (test.responses|selectattr('question_id','equalto',qid)|list|first) %}
        {% if resp %}
          {% set cls = 'correct' if resp.is_correct else 'wrong' %}
          {% set label = '✓' if resp.is_correct else '✗' %}
        {% else %}
          {% set cls = 'unanswered' %}
          {% set label = '…' %}
        {% endif %}
        <a class="btn btn-outline qbtn {{ cls }}" style="min-width:3.25rem; justify-content:center;"
           href="{{ url_for('student.review', test_id=test.id, q=i) }}">Q{{ i }} {{ label }}</a>
      {% endfor %}
    </div>
  </section>
</div>
{% endblock %}
